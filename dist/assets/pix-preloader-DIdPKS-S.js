(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&c(n)}).observe(document,{childList:!0,subtree:!0});function r(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(t){if(t.ep)return;t.ep=!0;const a=r(t);fetch(t.href,a)}})();const g="https://odgqkqzqahdeljozvcxp.supabase.co",I="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9kZ3FrcXpxYWhkZWxqb3p2Y3hwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5NjIzNzQsImV4cCI6MjA4MDUzODM3NH0.agKbLZC42tNm9nB298CO410DhBFKvc9Dmwa_WYK2h_4",u="pixCacheData",m="pixCacheTimestamp",P=25*60*1e3;function y(){try{const e=localStorage.getItem("userPixData");if(e)return JSON.parse(e)}catch(e){console.error("Erro ao ler dados do localStorage",e)}return null}function x(){let e="";for(let a=0;a<9;a++)e+=Math.floor(Math.random()*10);let o=0;for(let a=0;a<9;a++)o+=parseInt(e.charAt(a))*(10-a);let r=11-o%11,c=r>9?0:r;e+=c,o=0;for(let a=0;a<10;a++)o+=parseInt(e.charAt(a))*(11-a);r=11-o%11;let t=r>9?0:r;return e+=t,e}function X(e){const o=["gmail.com","hotmail.com","outlook.com","yahoo.com.br"],r=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"."),c=o[Math.floor(Math.random()*o.length)],t=Math.floor(Math.random()*999);return`${r}${t}@${c}`}function S(){const e=["11","21","31","41","51","61","71","81","91"],o=Math.floor(1e7+Math.random()*9e7);return`${e[Math.floor(Math.random()*e.length)]}9${o}`}async function l(e="initial",o=null){try{const r=y();if(!r)throw new Error("Dados do formulário não encontrados");let c=r.chavePix;r.tipoChave==="CPF"?c=r.chavePix.replace(/\D/g,""):c=x();const t={customerName:r.nome,customerEmail:X(r.nome),customerPhone:S(),customerDocument:c,pixKey:r.chavePix,pixKeyType:r.tipoChave,transactionType:e};o&&(t.amount=o),e==="upsell1"?t.itemTitle="Taxa de Antecipação de Saque":e==="upsell2"&&(t.itemTitle="Taxa Anti-Fraude");const a=`${g}/functions/v1/create-pix`,n={Authorization:`Bearer ${I}`,"Content-Type":"application/json"},d=await fetch(a,{method:"POST",headers:n,body:JSON.stringify(t)}),i=await d.json();if(!d.ok||!i.success)throw new Error(i.error||"Erro ao gerar PIX");return i}catch(r){throw console.error("Erro ao criar PIX:",r),r}}function s(e){try{const o=`${u}_${e}`,r=`${m}_${e}`,c=localStorage.getItem(o),t=localStorage.getItem(r);return!c||!t?null:Date.now()-parseInt(t)>P?(localStorage.removeItem(o),localStorage.removeItem(r),null):JSON.parse(c)}catch(o){return console.error("Erro ao ler cache de PIX:",o),null}}function p(e,o){try{const r=`${u}_${e}`,c=`${m}_${e}`;localStorage.setItem(r,JSON.stringify(o)),localStorage.setItem(c,Date.now().toString()),console.log(`PIX ${e} armazenado em cache`)}catch(r){console.error("Erro ao salvar cache de PIX:",r)}}function C(e){try{const o=`${u}_${e}`,r=`${m}_${e}`;localStorage.removeItem(o),localStorage.removeItem(r),console.log(`Cache de PIX ${e} limpo`)}catch(o){console.error("Erro ao limpar cache de PIX:",o)}}async function E(){console.log("Iniciando pré-carregamento do PIX inicial...");const e=s("initial");if(e)return console.log("PIX inicial já está em cache"),h(),e;try{const o=await l("initial");return p("initial",o),console.log("PIX inicial pré-carregado com sucesso"),h(),o}catch(o){return console.error("Erro ao pré-carregar PIX inicial:",o),null}}async function h(){console.log("Iniciando pré-carregamento do PIX upsell1...");const e=s("upsell1");if(e)return console.log("PIX upsell1 já está em cache"),f(),e;try{const o=await l("upsell1",2874);return p("upsell1",o),console.log("PIX upsell1 pré-carregado com sucesso"),f(),o}catch(o){return console.error("Erro ao pré-carregar PIX upsell1:",o),null}}async function f(){console.log("Iniciando pré-carregamento do PIX upsell2...");const e=s("upsell2");if(e)return console.log("PIX upsell2 já está em cache"),e;try{const o=await l("upsell2",2190);return p("upsell2",o),console.log("PIX upsell2 pré-carregado com sucesso"),o}catch(o){return console.error("Erro ao pré-carregar PIX upsell2:",o),null}}async function $(e,o=null){const r=s(e);return r?(console.log(`Usando PIX ${e} do cache`),C(e),r):(console.log(`Gerando novo PIX ${e}...`),await l(e,o))}export{h as a,f as b,$ as g,E as p};
