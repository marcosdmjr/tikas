import{g as s,a as d}from"./pix-preloader-DIdPKS-S.js";/* empty css                  */const l="https://odgqkqzqahdeljozvcxp.supabase.co",m="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9kZ3FrcXpxYWhkZWxqb3p2Y3hwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5NjIzNzQsImV4cCI6MjA4MDUzODM3NH0.agKbLZC42tNm9nB298CO410DhBFKvc9Dmwa_WYK2h_4";let a=null,i=null;function p(){try{const e=localStorage.getItem("userPixData");if(e)return JSON.parse(e)}catch(e){console.error("Erro ao ler dados do localStorage",e)}return null}function u(e){document.getElementById("loading").style.display="none";const t=document.getElementById("error-message");t.innerHTML=`<i class="fas fa-exclamation-circle"></i> ${e}`,t.style.display="block"}async function g(){try{if(!p())throw new Error("Dados do formulário não encontrados");const t=document.getElementById("loading-text");return localStorage.getItem("pixCacheData_initial")?t&&(t.textContent="Carregando pagamento..."):t&&(t.textContent="Gerando QRCode de pagamento..."),await s("initial")}catch(e){throw console.error("Erro ao criar PIX:",e),e}}function f(e){if(console.log("PIX gerado com sucesso:",e),a=e.transactionId,document.getElementById("loading").style.display="none",document.getElementById("payment-content").style.display="block",document.getElementById("amount").textContent=`R$ ${e.amount.toFixed(2).replace(".",",")}`,e.expirationDate){const o=new Date(e.expirationDate).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});document.getElementById("expiration").textContent=o}else{const o=new Date(Date.now()+18e5).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});document.getElementById("expiration").textContent=o}if(document.getElementById("pix-code").value=e.qrcode,typeof QRCode<"u"&&QRCode.toCanvas){const t=document.createElement("canvas");document.getElementById("qrcode").appendChild(t),QRCode.toCanvas(t,e.qrcode,{width:200,margin:2,color:{dark:"#000000",light:"#ffffff"}},function(o){o&&(console.error("Erro ao gerar QRCode:",o),c(e.qrcode))})}else c(e.qrcode);document.getElementById("copy-btn").addEventListener("click",function(){const t=document.getElementById("pix-code");t.select(),t.setSelectionRange(0,99999),navigator.clipboard.writeText(t.value).then(()=>{const o=document.getElementById("copy-btn");o.innerHTML='<i class="fas fa-check"></i> <span>Copiado!</span>',o.classList.add("copied"),setTimeout(function(){o.innerHTML='<i class="far fa-copy"></i> <span>Copiar</span>',o.classList.remove("copied")},2e3),d().catch(n=>{console.error("Erro ao pré-carregar PIX upsell1:",n)})}).catch(o=>{console.error("Erro ao copiar:",o)})}),a&&I(a)}function c(e){const t=document.getElementById("qrcode-img");t.src=`https://quickchart.io/qr?text=${encodeURIComponent(e)}&size=200`,t.style.display="block",document.getElementById("qrcode").style.display="none"}async function y(e){try{const t=`${l}/functions/v1/check-payment`,o={Authorization:`Bearer ${m}`,"Content-Type":"application/json"},r=await(await fetch(t,{method:"POST",headers:o,body:JSON.stringify({transactionId:e})})).json();return r.status==="paid"||r.status==="approved"}catch(t){return console.error("Erro ao verificar pagamento:",t),!1}}function I(e){i=setInterval(async()=>{await y(e)&&(clearInterval(i),window.location.href="/oferta-antecipacao.html")},5e3)}document.addEventListener("DOMContentLoaded",async function(){try{const e=await g();f(e)}catch(e){u("Erro ao gerar PIX. Por favor, tente novamente."),console.error(e)}});
